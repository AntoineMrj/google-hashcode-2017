# -*- coding: utf-8 -*-
"""
Created on Fri Nov 17 11:50:02 2017

@author: Antoine
"""

import outils
 
if __name__ == "__main__":

#-------------------------------------------------
    """ LECTURE DE LA MAP  : Code lecture_entete.py """
    map="rue_de_londres.in"               #Choix de la map   ( ex : charleston_road.in )
    entete = outils.lectureEntete(map)
    matrice = outils.creationMatrice(map)    #notre matrice

#-------------------------------------------------

    backbone = (int(entete[6]), int(entete[7]))   #on recupère les coord du backbone pour les ajouter à la liste de routeurs
    budget = int(entete[5])
    prix_routeur = int(entete[4])
    prix_fibre = int(entete[3])

    #charleston road
    #listeRouteurs = [[205, 125], [205, 104], [205, 83], [205, 62], [181, 131], [181, 110], [181, 89], [181, 68], [181, 47], [160, 34], [158, 123], [158, 71], [139, 34], [137, 123], [137, 71], [118, 34], [97, 34], [93, 123], [93, 71], [76, 34], [72, 123], [72, 71], [116, 143], [51, 93], [48, 128], [48, 49], [116, 93], [160, 145], [139, 145], [95, 145], [74, 145], [51, 72], [116, 122], [116, 72], [33, 115], [33, 94], [33, 73], [33, 52], [136, 108], [136, 56], [71, 108], [71, 56], [158, 108], [158, 56], [93, 108], [93, 56], [160, 93], [139, 93], [95, 93], [74, 93], [116, 55], [59, 34], [51, 114], [202, 50], [181, 34], [59, 143], [181, 143], [33, 135], [116, 114], [196, 129], [137, 145], [51, 70], [215, 52], [137, 93], [72, 93], [204, 108], [204, 87], [190, 45], [47, 45], [46, 137], [204, 71], [157, 108], [157, 56], [136, 129], [136, 77], [92, 108], [92, 56], [71, 129], [71, 77], [41, 50], [190, 140], [207, 136], [58, 142]]

    #rue de londres
    listeRouteurs = [[522, 287], [499, 258], [499, 237], [452, 261], [354, 108], [351, 147], [349, 176], [345, 225], [333, 117], [331, 253], [330, 155], [328, 184], [325, 289], [324, 232], [321, 322], [317, 354], [305, 168], [288, 259], [256, 310], [253, 339], [249, 87], [237, 229], [237, 208], [232, 339], [225, 85], [216, 229], [216, 208], [199, 326], [199, 250], [195, 229], [195, 208], [185, 90], [178, 341], [178, 320], [174, 222], [174, 201], [149, 197], [148, 245], [128, 219], [119, 198], [111, 243], [107, 222], [81, 196], [62, 238], [35, 62], [32, 127], [32, 84], [30, 231], [429, 271], [145, 75], [256, 257], [326, 208], [153, 221], [333, 96], [408, 268], [288, 107], [86, 220], [489, 279], [224, 252], [106, 84], [29, 205], [207, 98], [510, 119], [387, 266], [64, 208], [304, 192], [275, 228], [303, 149], [287, 309], [30, 148], [197, 347], [166, 77], [66, 186], [260, 213], [534, 173], [305, 368], [270, 89], [30, 174], [66, 85], [143, 92], [279, 209], [219, 350], [223, 324], [104, 191], [283, 331], [133, 242], [94, 241], [305, 133], [38, 110], [521, 136], [302, 93], [257, 236], [204, 81], [262, 110], [89, 82], [329, 140], [252, 289], [269, 284], [302, 230], [127, 90], [45, 191], [347, 205], [480, 250], [308, 273], [314, 333], [417, 252], [252, 363], [88, 67], [296, 288], [173, 98], [244, 318], [224, 104], [373, 251], [170, 244], [372, 264], [523, 270], [109, 70], [275, 349], [396, 253], [246, 104], [298, 216], [354, 129], [43, 216], [506, 219], [348, 196], [60, 105], [289, 248], [283, 368], [67, 65], [54, 139], [514, 283], [311, 213], [521, 247], [352, 245], [355, 98], [49, 170], [287, 90], [73, 240], [319, 108], [321, 297], [327, 163], [184, 78], [519, 188], [438, 257], [319, 372], [322, 253], [170, 257], [307, 294], [283, 291], [53, 122], [142, 194], [190, 250], [308, 252], [344, 267], [232, 356], [103, 209], [129, 71], [49, 58], [515, 204], [195, 200], [26, 98], [351, 166], [275, 255], [245, 264], [278, 314], [273, 332], [30, 195], [41, 161], [487, 236], [200, 319], [362, 260], [306, 352], [48, 237], [492, 110], [62, 231], [49, 78], [330, 273], [300, 329], [87, 179], [215, 201], [353, 138], [307, 113], [244, 242], [160, 92], [293, 349], [267, 302], [176, 315], [319, 94], [259, 198], [172, 342], [124, 191], [503, 115], [266, 366], [286, 266], [105, 98], [31, 63], [304, 309], [264, 329], [247, 275], [30, 169], [492, 271], [173, 197], [316, 318], [321, 285], [484, 289], [149, 220], [459, 256], [515, 229], [122, 82], [49, 99], [56, 70], [29, 228], [541, 168], [30, 119], [236, 204], [194, 100]]

    #Opera
    #listeRouteurs = [[646, 389], [644, 159], [643, 405], [640, 144], [631, 390], [629, 165], [628, 414], [628, 351], [627, 375], [626, 310], [626, 275], [626, 238], [626, 201], [625, 150], [625, 135], [616, 392], [613, 344], [611, 313], [611, 277], [611, 239], [611, 205], [610, 158], [604, 438], [602, 329], [602, 298], [602, 262], [602, 224], [602, 117], [601, 392], [598, 423], [598, 408], [598, 354], [597, 377], [597, 143], [596, 314], [596, 283], [596, 247], [596, 209], [596, 194], [596, 179], [595, 164], [589, 444], [587, 339], [587, 299], [587, 268], [587, 232], [587, 128], [587, 113], [586, 393], [583, 429], [583, 414], [583, 362], [582, 378], [582, 149], [581, 324], [581, 284], [581, 253], [581, 217], [581, 202], [581, 187], [580, 166], [572, 115], [568, 437], [557, 115], [554, 197], [553, 437], [553, 349], [553, 270], [553, 255], [553, 240], [553, 225], [552, 334], [552, 319], [552, 304], [552, 289], [551, 422], [550, 386], [550, 160], [542, 125], [542, 110], [539, 210], [539, 195], [538, 437], [538, 353], [538, 274], [538, 249], [537, 303], [536, 422], [527, 125], [527, 110], [524, 205], [523, 437], [523, 353], [523, 275], [523, 249], [522, 303], [521, 422], [521, 234], [520, 320], [515, 190], [514, 404], [512, 144], [512, 125], [512, 110], [509, 205], [508, 437], [508, 367], [508, 352], [508, 282], [508, 267], [507, 305], [506, 422], [506, 243], [506, 228], [505, 321], [500, 190], [499, 404], [497, 145], [497, 125], [497, 110], [494, 205], [493, 437], [493, 367], [493, 352], [493, 277], [492, 306], [491, 422], [491, 244], [491, 229], [490, 321], [485, 190], [484, 403], [482, 144], [482, 125], [482, 110], [479, 205], [478, 437], [478, 367], [478, 352], [478, 276], [477, 306], [476, 422], [476, 248], [476, 233], [475, 321], [472, 291], [470, 190], [467, 125], [467, 110], [464, 205], [463, 437], [463, 352], [463, 276], [462, 306], [461, 422], [461, 247], [461, 232], [460, 321], [452, 125], [452, 110], [449, 205], [448, 437], [448, 352], [448, 275], [447, 301], [446, 422], [446, 247], [443, 402], [443, 387], [443, 372], [442, 232], [442, 155], [441, 337], [441, 322], [441, 190], [441, 175], [437, 125], [437, 110], [434, 217], [433, 437], [433, 357], [433, 286], [433, 271], [432, 307], [431, 422], [431, 252], [427, 236], [426, 342], [426, 327], [426, 202], [422, 114], [422, 66], [419, 218], [418, 437], [416, 493], [416, 478], [416, 422], [415, 51], [414, 275], [412, 260], [412, 150], [411, 350], [411, 290], [411, 203], [408, 458], [408, 99], [408, 84], [407, 114], [407, 69], [406, 245], [406, 188], [405, 365], [405, 305], [403, 443], [401, 484], [401, 428], [399, 275], [398, 230], [397, 260], [397, 150], [396, 320], [396, 290], [392, 125], [391, 245], [391, 191], [390, 366], [390, 305], [386, 430], [384, 275], [384, 215], [384, 176], [383, 230], [382, 260], [382, 150], [381, 332], [381, 290], [378, 415], [378, 400], [377, 125], [376, 482], [376, 245], [376, 60], [375, 372], [375, 317], [371, 501], [371, 430], [371, 75], [371, 45], [370, 467], [369, 275], [369, 215], [369, 184], [369, 169], [368, 230], [367, 260], [366, 339], [366, 302], [362, 125], [361, 486], [361, 245], [361, 60], [360, 377], [360, 362], [360, 324], [356, 507], [356, 429], [356, 148], [356, 87], [356, 45], [355, 471], [355, 456], [354, 287], [354, 215], [354, 184], [354, 169], [353, 414], [353, 399], [353, 230], [352, 272], [351, 343], [351, 309], [347, 124], [346, 492], [346, 257], [346, 72], [345, 376], [345, 328], [341, 429], [341, 147], [341, 57], [341, 42], [340, 477], [339, 294], [339, 215], [339, 184], [339, 169], [338, 242], [337, 279], [336, 343], [336, 313], [335, 399], [332, 125], [331, 264], [330, 328], [326, 429], [326, 147], [324, 298], [324, 227], [324, 212], [324, 184], [324, 169], [323, 249], [322, 283], [321, 344], [321, 313], [317, 117], [316, 268], [313, 481], [313, 458], [313, 58], [312, 91], [312, 76], [311, 429], [311, 147], [309, 298], [309, 234], [308, 253], [307, 283], [304, 219], [304, 204], [304, 189], [304, 174], [304, 132], [302, 343], [302, 328], [302, 313], [302, 117], [301, 268], [298, 492], [298, 477], [298, 61], [297, 77], [294, 298], [294, 238], [293, 253], [292, 283], [286, 268], [284, 434], [282, 223], [282, 208], [282, 162], [282, 147], [282, 123], [282, 108], [281, 400], [281, 385], [281, 367], [281, 352], [281, 337], [281, 322], [279, 307], [279, 238], [278, 253], [277, 292], [271, 277], [269, 435], [268, 193], [267, 223], [267, 208], [267, 162], [267, 124], [267, 109], [266, 345], [266, 330], [264, 315], [264, 238], [263, 262], [262, 300], [256, 285], [254, 435], [252, 223], [252, 208], [252, 162], [252, 124], [252, 109], [251, 345], [251, 330], [249, 315], [249, 247], [248, 270], [247, 300], [241, 366], [241, 285], [240, 399], [240, 384], [239, 435], [237, 232], [237, 217], [237, 202], [237, 162], [237, 124], [237, 109], [236, 345], [236, 330], [234, 315], [234, 255], [233, 270], [232, 300], [226, 285], [224, 435], [222, 240], [222, 225], [222, 210], [222, 162], [222, 124], [222, 109], [221, 345], [221, 330], [219, 315], [219, 255], [218, 270], [217, 300], [211, 285], [209, 435], [207, 240], [207, 225], [207, 210], [207, 162], [207, 124], [207, 109], [206, 344], [204, 329], [204, 255], [203, 270], [202, 314], [196, 299], [194, 435], [193, 365], [193, 195], [193, 180], [192, 240], [192, 225], [192, 210], [192, 162], [192, 124], [192, 109], [191, 350], [189, 335], [189, 255], [188, 284], [187, 320], [183, 147], [181, 305], [179, 435], [177, 124], [177, 109], [174, 269], [173, 290], [166, 313], [165, 420], [165, 381], [165, 366], [165, 162], [165, 147], [164, 435], [164, 398], [164, 351], [164, 186], [163, 336], [163, 254], [163, 231], [162, 216], [162, 201], [162, 123], [162, 108], [159, 275], [158, 298], [151, 314], [147, 123], [147, 108], [144, 281], [144, 266], [136, 314], [136, 251], [135, 391], [135, 376], [134, 342], [134, 225], [134, 184], [134, 167], [134, 152], [129, 288], [129, 273], [127, 122], [127, 107], [124, 411], [123, 137], [121, 323], [121, 258], [119, 233], [119, 184], [119, 167], [119, 152], [115, 361], [114, 285], [112, 118], [106, 428], [106, 323], [106, 270], [106, 202], [104, 234], [104, 184], [104, 152], [100, 361], [99, 285], [98, 255], [91, 323], [91, 270], [87, 166], [86, 183], [85, 361], [71, 183], [70, 359], [64, 289], [63, 308], [63, 255], [63, 235], [56, 183], [55, 393], [55, 359], [55, 153], [30, 183], [29, 359], [22, 333], [22, 215], [537, 338], [147, 202], [119, 342], [87, 143], [396, 350], [392, 59], [256, 383], [181, 382], [149, 360], [103, 342], [293, 46], [572, 347], [513, 175], [471, 175], [345, 361], [91, 221], [494, 175], [149, 186], [330, 368], [538, 234], [354, 109], [102, 390], [356, 30], [222, 195], [196, 382], [116, 308], [430, 143], [340, 462], [132, 203], [88, 377], [375, 357], [108, 219], [300, 159], [411, 335], [264, 178], [575, 309], [227, 421], [212, 421], [197, 421], [182, 421], [181, 398], [134, 360], [522, 339], [428, 394], [392, 110], [211, 382], [71, 137], [463, 262], [178, 231], [535, 388], [40, 384], [283, 193], [335, 502], [409, 173], [572, 269], [149, 228], [208, 195], [629, 186], [152, 383], [529, 158], [395, 459], [303, 372], [299, 451], [252, 193], [149, 345], [537, 289], [189, 270], [539, 323], [507, 339], [492, 339], [477, 339], [462, 339], [350, 202], [332, 112], [269, 422], [256, 399], [254, 422], [106, 167], [101, 310], [51, 333], [39, 158], [112, 103], [571, 388], [472, 399], [49, 210], [626, 336], [328, 483], [226, 383], [576, 238], [156, 171], [304, 397], [328, 61], [179, 362], [464, 369], [153, 329], [335, 202], [303, 420], [300, 98], [286, 62], [554, 212], [625, 261], [566, 159], [517, 389], [411, 405], [396, 95], [371, 113], [284, 422], [65, 341], [65, 204], [427, 157], [177, 205], [456, 192], [396, 80], [155, 246], [132, 428], [494, 264], [123, 218], [365, 203], [86, 401], [519, 290], [431, 379], [471, 142], [458, 160], [179, 183], [569, 197], [457, 291], [628, 223], [446, 262], [400, 50], [91, 236], [391, 477], [374, 143], [339, 230], [152, 398], [72, 328], [628, 295], [478, 263], [44, 352], [519, 374], [471, 160], [459, 402], [459, 387], [459, 145], [338, 418], [323, 418], [270, 400], [268, 366], [262, 147], [237, 187], [200, 147], [196, 398], [121, 439], [71, 403], [71, 155], [38, 334], [341, 83], [307, 358], [178, 254], [596, 103], [546, 148], [91, 291], [271, 383], [20, 202], [442, 142], [24, 174], [549, 183], [103, 377], [56, 140], [549, 371], [152, 145], [113, 249], [242, 422], [72, 214], [38, 215], [320, 329], [284, 181], [274, 142], [397, 414], [71, 388], [575, 294], [517, 160], [505, 161], [494, 388], [494, 160], [308, 49], [237, 147], [225, 147], [212, 147], [145, 434], [136, 329], [78, 344], [623, 405], [521, 224], [519, 260], [313, 494], [178, 345], [581, 103], [249, 180], [150, 418], [110, 137], [115, 422], [581, 134], [538, 264], [369, 290], [332, 33], [300, 144], [375, 32], [45, 183], [433, 172], [424, 312], [372, 394], [21, 324], [322, 202], [575, 332], [545, 168], [431, 409], [549, 401], [506, 389], [483, 384], [483, 161], [476, 224], [472, 384], [426, 190], [353, 522], [250, 147], [210, 365], [78, 199], [529, 143], [183, 162], [460, 223], [210, 180], [180, 220], [100, 132], [579, 403], [91, 310], [228, 366], [91, 252], [74, 268], [20, 187], [566, 106], [487, 297], [313, 449], [60, 279], [551, 130], [539, 225], [402, 499], [264, 253], [117, 387], [303, 435], [159, 261], [628, 322], [443, 290], [407, 129], [356, 443], [21, 353], [530, 404], [361, 75], [333, 382], [257, 366], [91, 346], [79, 253], [79, 238], [628, 366], [410, 374], [398, 202], [395, 444], [291, 465], [227, 180], [154, 290], [238, 360], [626, 171], [485, 175], [57, 382], [36, 200], [643, 237], [598, 369], [353, 391], [249, 262], [203, 285], [576, 223], [395, 178], [306, 382], [152, 368], [134, 239], [602, 344], [602, 132], [152, 217], [38, 324], [639, 135], [381, 305], [369, 87], [293, 497], [252, 238], [164, 138], [136, 296], [396, 219], [368, 419], [157, 433], [89, 159], [321, 371], [568, 430], [530, 194], [412, 143], [397, 143], [231, 399], [223, 399], [215, 399], [207, 399], [131, 310], [90, 206], [79, 313], [79, 298], [79, 283], [535, 141], [429, 298], [60, 266], [51, 324], [123, 203], [122, 402], [88, 389], [73, 224], [504, 297], [423, 107], [393, 330], [354, 19], [331, 394], [643, 310], [508, 255], [313, 473], [180, 142], [156, 160], [643, 274], [324, 242], [378, 206], [368, 458], [181, 324], [60, 224], [449, 220], [441, 205], [353, 245], [237, 247], [121, 273], [101, 403], [336, 72], [115, 293], [393, 393], [139, 418], [626, 246], [294, 313], [581, 179], [536, 405], [422, 77], [169, 284], [27, 368], [641, 203], [533, 175], [422, 48], [551, 107], [530, 385], [413, 393], [218, 365], [626, 212], [355, 98], [643, 346], [587, 354], [381, 191], [348, 506], [181, 246], [47, 374], [287, 74], [101, 204], [389, 352], [330, 360], [616, 383], [120, 357], [28, 162], [354, 302], [347, 112], [211, 300], [568, 277], [550, 361], [423, 232], [396, 65], [334, 48], [166, 328], [77, 375], [576, 254], [297, 207], [464, 177], [447, 339], [300, 223], [311, 111], [610, 268], [597, 158], [582, 444], [346, 141], [60, 314], [60, 252], [646, 382], [107, 121], [60, 404], [557, 385], [523, 179], [491, 224], [455, 175], [406, 477], [332, 492], [331, 142], [320, 398], [293, 482], [237, 180], [147, 136], [90, 191]]

    #listeRouteurs = outils.placement_routeurV1(matrice,entete) #à décommenter pour faire tourner l'algo 30min
    arbreMini = outils.relierRouteurs(listeRouteurs, backbone) #Renvoie la liste des coordonnées de toutes les fibres à placer (routeurs compris)
    prix = outils.prix(len(listeRouteurs),len(arbreMini),prix_fibre,prix_routeur)

    print(budget)
    print(prix)

    if prix > budget:
        val = int(((prix - budget) // prix_routeur)*0.9) #val = la valeur arrondie de 90% des routeurs en trop
        print('Suppression de ',val,' routeurs')
        for i in range(val): #on enlève 90% des routeurs en trop d'un coup
            listeRouteurs.pop(-1)
        prix = outils.prix(len(listeRouteurs), len(arbreMini), prix_fibre, prix_routeur)

    while prix > budget: #Tant qu'on dépasse le budget
        print('Suppression d un routeur...')
        listeRouteurs.pop(-1) #supprime le dernier routeur de la liste (celui avec le moins bon score)
        print('Recalcul de l arbre...')
        arbreMini = outils.relierRouteurs(listeRouteurs,backbone) #on recalcule l'arbre avec un routeur de moins
        prix = outils.prix(len(listeRouteurs),len(arbreMini),prix_fibre,prix_routeur) #on recalcule le prix
        print('Nouveau prix : ', prix)
        print('===============')


    outils.ecrire_fichier(len(arbreMini),arbreMini,len(listeRouteurs),listeRouteurs)

